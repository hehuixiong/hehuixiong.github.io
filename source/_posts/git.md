---
title: 耀企GIT使用规范 v2.0
date: 2020-12-07 15:07:43
sticky: 1
cover: https://s3.ax1x.com/2020/12/07/DxMfhT.jpg
top_img: https://s3.ax1x.com/2020/12/07/DxMfhT.jpg
categories: 
    - 耀企云库
copyright_author: 三·钻 TriDiamond
copyright_author_href: https://tridiamond.tech/
copyright_info: 此文章为公司内部文档, 由 <a href="https://tridiamond.tech/">三·钻 TriDiamond</a> 著, 属于存档记录
---

# 耀企GIT使用规范 v2.0
> Git usage standards version 2.0
# 介绍
每一个优秀的开发团队都会用到一套代码管理工具。根据目前最流行的代码管理工具非`GIT`莫属。不例外耀企团队绝对使用最优秀的规范和工具。根据耀企项目的具体部署环境，开发规范，我们有一套自己的规范和标准的`GIT`使用方式。

# 敏捷迭代
    如果要弄明白耀企的GIT使用，首先要了解清楚耀企项目的迭代流程

![](/git/agile_development.png)

#### 什么是敏捷迭代？
> 敏捷迭代就是把开发周期缩短到1-4周。小步快跑的迅速迭代交付功能上线。敏捷迭代的流程分别如下：
1. 确定需求 - _与老板和市场确认需求和流程_
2. 需求评审 - _与开发同频需求里面的功能点和业务流程_
3. 技术反讲 - _开发与产品同频需求，保证理解没有误区，开发也需要评估开发难度，和开发时间_
4. 研发周期 - _开发人员开始投入研发直接到功能和需求开发完毕，转交给测试，在测试环境提测_
5. 测试周期 - _测试和开发人员开始排除困难，修复所有在开发过程产生的bug_
6. 验收/预发布周期 - _当测试在测试环境把所有bug排除掉后，当前迭代版本就会发布到预发布环境让市场和产品验收功能_
7. 发布正式 - _当验收通过后，当前迭代版本就可以部署上先到正式环境_
8. 正式回归测试 - _发布上线后，就会有正式回归测试，最有一道防线，保证系统加入了所有新功能都没有问题_
9. 迭代总结 - _每一期迭代结束后都总结这次迭代遇到的问题，持续优化，提高效率_

#### 开发环境

![](/git/agile_dev_envs.png)

    开发环境和git分支是一一对应的。

+ 版本开发环境 - _dev/x.x.x 版本分支_
+ 测试/联调环境 - _qa/qa1，qa/qa2，qa/qa3 3个测试环境和分支_
+ 预发布/验收环境 - _release分支_
+ 正式线上环境 - _master分支_

# Git操作场景
    这里我们按照实际开发流程和实际场景来解说怎么使用git

> ### 开启新版本迭代
![](/git/start_agile.png)

#### 操作步骤
1. 从master分支创建一个版本分支
2. 创建版本分支后根据不同的端做不同的处理
    - 前端：需要把接口版本好改为当前迭代的接口版本号
    - 后端：先创建对应当前迭代的接口版本好控制器和路由，然后合并就版本的控制器更变。

> ### 开发周期版本提测/bug修复提测
![](/git/agile_qa_start.png)

    提验收必须从版本分支合并qa分支

#### 操作步骤
1. 版本分支合并(merge)对应的测试分支(qa)
2. 版本分支代码合并后对应的qa环境会自动部署代码到对应的环境服务器上

> ### 开发周期版本提验收/bug修复提验收
![](/git/agile_stage_start.png)

    提测必须从版本分支合并验收(release)分支

#### 操作步骤
1. 版本分支合并(merge)验收分支(release)
2. 版本分支代码合并release环境会自动部署代码到环境服务器上
    - 如果是修复bug，就要先合并对应的qa分支后合并release分支。

> ### 使用前版本修复上线流程
![](/git/agile_bugfix.png)

#### 操作步骤
1. 使用当前`正式所在的版本`找到对应的`版本分支`作为修复分支
2. 修复完成后合并对应的qa环境提测，然后提醒测试开始回归测试修复
3. 测试环境测试通过后把修复分支合并release分支，然后提醒测试在验收环境验收修复
4. 验收通过后，就可以通知开发组长以上的负责人合并master分支上线，然后通知测试在线上回归测试
5. 在线上回归通过后，就可以把修复分支分别合并到`当前迭代版本分支`

> ### 紧急修复上线流程
 - 如果当前bug是很严重的，影响到用户使用的才需要使用紧急修复上线流程
 - 紧急修复上线必须先创建紧急修复(hotfix)分支
![](/git/agile_hotfix.png)

#### 操作步骤
1. 首先使用master分支创建紧急修复分支(hotfix/xxxx) - 使用`hotfix`前缀
2. 修复完成后合并对应的qa环境提测，然后提醒测试开始回归测试修复
3. 测试环境测试通过后把修复分支合并release分支，然后提醒测试在验收环境验收修复
4. 验收通过后，就可以通知开发组长以上的负责人合并master分支上线，然后通知测试在线上回归测试
5. 在线上回归通过后，就可以把修复分支分别合并到`前版本分支`和`当前迭代版本分支`
6. 最后在`本地(local)`和`远程(origin)`删除修复分支

> ### 后端代码部署操作流程
 - 因为后端把不同模块都独立成一个composer包，所以git合并和部署流程跟前端是有区别的。这里分开来说明流程。
![](/git/agile_backend_git.png)

#### 操作步骤
1. 首先用每个`模块`的`版本分支`合并对应的qa分支
2. 然后切换到`Foundation`应用，然后推送对应的环境发起环境部署
    - 如果涉及多个模块需要同时发布，那就先把所有模块先合并好环境分支，然后再推Foundation。因为Foundation的某个环境启动了部署，必须部署完后才能发起下一次部署。